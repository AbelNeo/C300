<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bukayo Saka Profile | FootMaster Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css">
    <!-- Only JSON in importmap! -->
    <script type="importmap">
    {
      "imports": {
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
      }
    }
    </script>
    <script type="module" src="js/firebase.js"></script>
    <script type="module" src="js/players.js"></script>
    <script type="module" src="js/main.js"></script>
    <script type="module" src="components/navbar-component.js"></script>
    <script type="module">
      import { db, auth } from '../js/firebase.js';
      import { doc, getDoc, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      // Config: set the playerId as per your database
      const playerId = "playerId3"; 

      const star = document.getElementById('favoriteStar');

      let currentUserUid = null;

      // Utility: get user's favoritePlayers array
      async function getFavoritePlayers(uid) {
        const userRef = doc(db, "Accounts", uid);
        const snap = await getDoc(userRef);
        if (!snap.exists()) return [];
        return snap.data().favoritePlayers || [];
      }

      // Update the star UI
function setStarActive(isActive) {
  if (isActive) {
    star.classList.add('active');
    star.title = 'Remove from favorites';
    star.src = 'https://images.onefootball.com/cw/icons/star-yellow-dark.svg'; // Filled star
  } else {
    star.classList.remove('active');
    star.title = 'Add to favorites';
    star.src = 'https://images.onefootball.com/cw/icons/star-outline-dark.svg'; // Outline/star-off
  }
}


      // Auth state: check if player is favorite for user
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          currentUserUid = user.uid;
          const favs = await getFavoritePlayers(currentUserUid);
          setStarActive(favs.includes(playerId));
          star.style.display = '';
        } else {
          setStarActive(false);
          star.style.display = 'none'; // Hide if not logged in
        }
      });

      // Star click handler: toggle favorite in user doc
      star.addEventListener('click', async () => {
        if (!currentUserUid) {
          alert('Sign in to add favorites');
          return;
        }
        star.style.pointerEvents = 'none'; // Prevent double click
        const userRef = doc(db, "Accounts", currentUserUid);
        const favs = await getFavoritePlayers(currentUserUid);
        try {
          if (favs.includes(playerId)) {
            await updateDoc(userRef, { favoritePlayers: arrayRemove(playerId) });
            setStarActive(false);
          } else {
            // Only allow up to 3 favorites
            if (favs.length >= 3) {
              alert('You can only have up to 3 favorite players.');
              return;
            }
            await updateDoc(userRef, { favoritePlayers: arrayUnion(playerId) });
            setStarActive(true);
          }
        } catch (err) {
          alert('Failed to update favorites: ' + err.message);
        } finally {
          star.style.pointerEvents = '';
        }
      });
    </script>
</head>
<body>
    <header>
        <navbar-component></navbar-component>
    </header>
    <main class="container">
      <section class="players-section" style="margin-bottom: 1.5em; display: flex; align-items: flex-start;">
        <!-- Star at left of card -->
        <div style="margin-right: 24px; display: flex; align-items: center;">
          <img
            id="favoriteStar"
            alt="Favorite Player"
            decoding="async"
            loading="lazy"
            width="32"
            height="32"
            srcset="https://image-service.onefootball.com/transform?w=32&amp;dpr=2&amp;image=https://images.onefootball.com/cw/icons/star-yellow-dark.svg 1x, https://image-service.onefootball.com/transform?w=48&amp;dpr=2&amp;image=https://images.onefootball.com/cw/icons/star-yellow-dark.svg 2x"
            src="https://image-service.onefootball.com/transform?w=48&amp;dpr=2&amp;image=https://images.onefootball.com/cw/icons/star-yellow-dark.svg"
            class="star-favorite"
            style="color: transparent;"
            title="Add/Remove Favorite"
          >
        </div>
        <div class="player-card" style="max-width: 350px; margin: 0 auto;">
            <img src="images/players/SakaHalfBody.jpeg" alt="Bukayo Saka" class="player-portrait" style="height: 240px;">
            <div class="player-info">
                <h3 class="player-name">Bukayo Saka</h3>
                <p class="player-position">Forward</p>
                <p class="player-team">Arsenal &amp; England</p>
            </div>
        </div>
      </section>

      <div class="divider"></div>

      <!-- Teams Section -->
      <section class="teams-grid" style="margin-bottom:1.5em;">
          <h2 style="color:#800000; margin-bottom:16px;">Teams</h2>
          <div style="display:flex; gap:32px; flex-wrap:wrap;">
              <div class="player-card" style="width:160px;">
                  <img src="images/england-logo.png" alt="England" class="player-portrait" style="height: 80px;">
                  <div class="player-info">
                      <p class="player-team">England</p>
                  </div>
              </div>
              <div class="player-card" style="width:160px;">
                  <img src="images/arsenal-logo.jpeg" alt="Arsenal" class="player-portrait" style="height: 80px;">
                  <div class="player-info">
                      <p class="player-team">Arsenal</p>
                  </div>
              </div>
          </div>
      </section>

      <!-- Key Stats Section -->
      <section class="stats-container" style="background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.07); padding:24px; max-width:650px; margin:0 auto;">
          <p class="title" style="color:#800000; font-weight: 600;">KEY STATS</p>
          <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(110px,1fr)); gap:18px; margin-top:18px;">
              <div>
                  <p style="font-size:1.4em; color:#800000; font-weight:600;">23</p>
                  <p>Age</p>
              </div>
              <div>
                  <p style="font-size:1.2em; color:#800000;">Forward</p>
                  <p>Position</p>
              </div>
              <div>
                  <p style="font-size:1.2em;">England</p>
                  <p>Country</p>
              </div>
              <div>
                  <p>178 cm</p>
                  <p>Height</p>
              </div>
              <div>
                  <p>72 kg</p>
                  <p>Weight</p>
              </div>
              <div>
                  <p>7</p>
                  <p>Jersey Number</p>
              </div>
          </div>
      </section>
    </main>
    
</body>
</html>